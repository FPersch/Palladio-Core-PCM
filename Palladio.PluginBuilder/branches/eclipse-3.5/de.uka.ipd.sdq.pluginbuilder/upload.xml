<project name="UpdateSite" default="upload">
	
	<taskdef resource="org/pluginbuilder/anttasks/pluginbuildertasks.properties" classpath="build-files/pluginbuilder-anttasks.jar" />
	
	<GetHostName />
	<property file="build_${hostname}.properties" />
	<property file="build_local.properties" />
	<property file="upload.properties" />
	
	<target name="clean_remote">
		<sshexec host="${uploadTargetHost}"
				username="${uploadUsername}"
				keyfile="/home/ccontrol/.ssh/id_rsa" 
				passphrase="" 
				trust="true" 
		command="cd ${uploadTargetDir}; 
			rm -rf *; 
			"/>
	</target>

	<target name="upload" depends="clean_remote">
		<scp todir="${uploadUsername}@${uploadTargetHost}:${uploadTargetDir}"
				keyfile="/home/ccontrol/.ssh/id_rsa" 
				passphrase="" 
				trust="true">
		    <fileset dir="${buildDirectory}/p2-updateSite"/>
	  	</scp>			
		<scp todir="${uploadUsername}@${uploadTargetHost}:${uploadTargetDir}"
				keyfile="/home/ccontrol/.ssh/id_rsa" 
				passphrase="" 
				trust="true">
			<fileset dir="${buildDirectory}">
				<include name="*.txt" />				
			</fileset>
	  	</scp>
		
		<!-- test results: -->
		<scp todir="${uploadUsername}@${uploadTargetHost}:${uploadTargetDir}"
				keyfile="/home/ccontrol/.ssh/id_rsa" 
				passphrase="" 
				trust="true">
		    <fileset dir="${buildDirectory}/results/testresults/html"/>
	  	</scp>
		<!-- <scp todir="${uploadUsername}@${uploadTargetHost}:${uploadTargetDir}"
				keyfile="/home/ccontrol/.ssh/id_rsa" 
				passphrase="" 
				trust="true">
		    <fileset dir="${buildDirectory}/results/testresults/coverage"/>
	  	</scp> -->
	  	<sshexec host="${uploadTargetHost}"
				username="${uploadUsername}"
				keyfile="/home/ccontrol/.ssh/id_rsa" 
				passphrase="" 
				trust="true" 
				command="cd ${uploadTargetDir}; 
			mv test*.html testresults.html; 
			"/> 
	</target>
	
</project>
