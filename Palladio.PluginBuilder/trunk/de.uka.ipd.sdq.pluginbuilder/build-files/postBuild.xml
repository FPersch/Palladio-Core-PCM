<project name="Run as part of postBuild" default="main">
    
    <target name="main">
        <property name="UpdateSiteStagingLocation" value="${buildResultsDirectory}/../updateSite"/>
        <antcall target="-generateUpdateSite"/>
    	
    	<!-- <antcall target="javadoc" /> --> <!-- by kelsaka -->
    	<!-- <antcall target="javadoc-pcm" /> -->  <!-- by kelsaka -->
    </target>
    
    <!--======================================================-->
    <!-- UpdateSite Export target, to be called from allElements  -->
    <!-- ==================================================== -->
    <target name="updateSiteExport">
        <ant antfile="build.xml" dir="${buildDirectory}/features/${id}/" target="build.update.jar">
            <property name="feature.destination" value="${UpdateSiteStagingLocation}/features"/>
            <property name="plugin.destination" value="${UpdateSiteStagingLocation}/plugins"/>
        </ant>
    </target>
    
    <target name="-generateUpdateSite">
        <!-- Create the directory structure -->
        <mkdir dir="${UpdateSiteStagingLocation}"/>
        <mkdir dir="${UpdateSiteStagingLocation}/features"/>
        <mkdir dir="${UpdateSiteStagingLocation}/plugins"/>
        <!-- Build the jar files -->
        <ant antfile="${builder}/customTargets.xml" target="allElements">
            <property name="genericTargets" value="${builder}/postBuild.xml"/>
            <property name="target" value="updateSiteExport"/>
        </ant>
        <!-- site.xml files for integration and release builds are handled elsewhere -->
        <antcall target="-createNightlyBuildSiteXml"/>
        <delete dir="${buildDirectory}/temp.updatesite"/>
	<antcall target="createP2Site"/>
    </target>
	
	<target name="createP2Site">
		<java fork="true" timeout="10800000" taskname="p2"
	   		  jvm="/usr/bin/java" failonerror="false" maxmemory="256m"
			  classname="org.eclipse.equinox.launcher.Main">
	   		<classpath>
	     		<fileset dir="/home/ccontrol/eclipse/plugins"
	       			includes="org.eclipse.equinox.launcher_*.jar,
	         			org.eclipse.equinox.p2.metadata.generator_*.jar"/>
	     		<pathelement location="/home/ccontrol/eclipse/plugins" />
	   		</classpath>
	   		<arg line=" org.eclipse.equinox.launcher.Main" />
	   		<arg line=" -application org.eclipse.equinox.p2.metadata.generator.EclipseGenerator" />
	   		<arg line=" -updateSite ${UpdateSiteStagingLocation}/ -site file:${UpdateSiteStagingLocation}/site.xml" />
	   		<arg line=" -metadataRepository file:${UpdateSiteStagingLocation}/ -metadataRepositoryName &quot;PCM Updates&quot;" />
	   		<arg line=" -artifactRepository file:${UpdateSiteStagingLocation}/ -artifactRepositoryName &quot;PCM Artifacts&quot;" />
	   		<arg line=" -noDefaultIUs -compress -reusePack200Files" />
	 	</java>
	</target>
	
    <!-- replace at least yourFeature, categoryName and categoryDef --> 
    <target name="-createNightlyBuildSiteXml" if="isNightlyBuild">
        <echo file="${UpdateSiteStagingLocation}/site.xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;site&gt;
	&lt;description url=&quot;http://sdqweb.ipd.uka.de/eclipse/PCM_nightly/&quot;&gt;
    	Update site for the Palladio Component Model.
    	The plugins contained in this feature enable modelling and accessing instances
    	of the Palladio Component Model stored in XMI using EMF.
	&lt;/description&gt;
	&lt;feature url=&quot;features/de.uka.ipd.sdq.pcm.feature_${version.full}.jar&quot; id=&quot;de.uka.ipd.sdq.pcm.feature&quot; version=&quot;${version.full}&quot;&gt; 
		&lt;category name=&quot;CBSE Modelling&quot;/&gt;
	&lt;/feature&gt;
	&lt;feature url=&quot;features/de.uka.ipd.sdq.pcm.diagram.feature_${version.full}.jar&quot; id=&quot;de.uka.ipd.sdq.pcm.diagram.feature&quot; version=&quot;${version.full}&quot;&gt;
		&lt;category name=&quot;CBSE Modelling&quot;/&gt;
	&lt;/feature&gt;
	&lt;feature url=&quot;features/de.uka.ipd.sdq.probfunction.feature_${version.full}.jar&quot; id=&quot;de.uka.ipd.sdq.probfunction.feature&quot;	version=&quot;${version.full}&quot;&gt;
		&lt;category name=&quot;CBSE Modelling&quot;/&gt;
	&lt;/feature&gt;
	&lt;feature	url=&quot;features/de.uka.ipd.sdq.simucom.feature_${version.full}.jar&quot;	id=&quot;de.uka.ipd.sdq.simucom.feature&quot; version=&quot;${version.full}&quot;&gt;
		&lt;category name=&quot;CBSE Modelling&quot;/&gt;
	&lt;/feature&gt;
	&lt;feature url=&quot;features/de.uka.ipd.sdq.sensorframework.feature_${version.full}.jar&quot;	id=&quot;de.uka.ipd.sdq.sensorframework.feature&quot; version=&quot;${version.full}&quot;&gt;
		&lt;category name=&quot;CBSE Modelling&quot;/&gt;
	&lt;/feature&gt;
	&lt;feature	url=&quot;features/de.uka.ipd.sdq.pcmsolver.feature_${version.full}.jar&quot; id=&quot;de.uka.ipd.sdq.pcmsolver.feature&quot; version=&quot;${version.full}&quot;&gt;
		&lt;category name=&quot;CBSE Modelling&quot;/&gt;
	&lt;/feature&gt;
	&lt;feature	url=&quot;features/de.uka.ipd.sdq.sensorframework.visualisation.feature_${version.full}.jar&quot; id=&quot;de.uka.ipd.sdq.sensorframework.visualisation.feature&quot; version=&quot;${version.full}&quot;&gt;
		&lt;category name=&quot;CBSE Modelling&quot;/&gt;
	&lt;/feature&gt;
	&lt;feature	url=&quot;features/de.uka.ipd.sdq.workflow.feature_${version.full}.jar&quot; id=&quot;de.uka.ipd.sdq.workflow.feature&quot; version=&quot;${version.full}&quot;&gt;
		&lt;category name=&quot;CBSE Modelling&quot;/&gt;
	&lt;/feature&gt;
	&lt;category-def name=&quot;CBSE Modelling&quot; label=&quot;CBSE Modelling&quot;&gt;
		&lt;description&gt;
			Component Based software engineering is
			about building software systems from basic building blocks, so called
			components.
		&lt;/description&gt;
	&lt;/category-def&gt;
&lt;/site&gt;
        </echo>  	
    </target>
	
	<!-- ================================================= -->
	<!-- Added by kelsaka: Creates javadoc for the project -->
	<!-- ================================================= -->
	<target name="javadoc" description="Generate JavaDoc for the project">
		<echo>starting to create JavaDoc...</echo>		
		<mkdir dir="${buildDirectory}/updateSite/javadoc/" />
	    <javadoc 
	    	destdir="${buildDirectory}/updateSite/javadoc/"
	    	author="true" 
	    	defaultexcludes="yes"
	    	public="true"
	    	use="true" 
	    	version="true" 
	    	verbose="true"			
	    	windowtitle="Palladio Component Model (PCM)"
	    	linkoffline="http://www.palladio-approach.net"	    	
	    	failonerror="false"
	    	maxmemory="256m"
	    	>
	<!--
			maxmemory="256m"
	    	source="${buildDirectory}"  
	    	excludepackagenames="${build.src.excludes}" 
	    	packagenames="${build.doc.packages}"
	    	public="true"
	    	sourcepathref="project.source"
	-->
	        <!-- <classpath refid="de.uka.ipd.sdq.classpath"/> -->
	        <doctitle><![CDATA[<h1>${project.name}</h1]]></doctitle>
	        <link href="http://java.sun.com/javase/6/docs/api/"/>
			<!-- <taglet name="org.apache.commons.attributes.javadoc.CATaglet" 
				path="${ant.home}/lib/commons-attributes-compiler-2.2.jar"/> -->	
	    	<fileset dir="${buildDirectory}/plugins/">
	    		<include name="de.uka.ipd.sdq.codegen.simucontroller/**/*.java" />
	    		
	    		<!--<include name="de.uka.ipd.sdq.sensorframework.adapter/**/*.java" />
	    		<include name="de.uka.ipd.sdq.pcm.gmf.allocation/**/*.java" />
	    		<include name="de.uka.ipd.sdq.stoex.analyser/**/*.java" />
	    		<include name="de.uka.ipd.sdq.branding/**/*.java" />
	    		<include name="de.uka.ipd.sdq.completions/**/*.java" />
	    		<include name="de.uka.ipd.sdq.pcm.gmf.composite/**/*.java" />
	    		<include name="de.uka.ipd.sdq.scheduler.configuration/**/*.java" />
	    		<include name="de.uka.ipd.sdq.context/**/*.java" />
	    		<include name="de.uka.ipd.sdq.codegen.simudatavisualisation.datatypes/**/*.java" />	
	    		<include name="de.uka.ipd.sdq.codegen.simucontroller/**/*.java" />
	    		<include name="de.uka.ipd.sdq.simucomframework.desmoj/**/*.java" />
	    		<include name="de.uka.ipd.sdq.dialogs/**/*.java" />
	    		<include name="de.uka.ipd.sdq.pcm.dialogs/**/*.java" />
	    		<include name="de.uka.ipd.sdq.sensorframework.dialogs/**/*.java" />
	    		<include name="de.uka.ipd.sdq.completions.edit/**/*.java" />
	    		<include name="de.uka.ipd.sdq.context.edit/**/*.java" />
	    		<include name="de.uka.ipd.sdq.pcm/**/*.java" /> -->
	
	    		<!-- <include name="**/de.uka.ipd.sdq.pcm**/*.java" /> --> 
	    		<!-- <exclude name="" /> -->
	    		<!-- <include name="de.uka.ipd.sdq.codegen.simucontroller/**/*.java" /> -->
	    	</fileset>
	    	
	    </javadoc>
		<echo>...finished creating JavaDoc.</echo>
	</target>
	<!-- ======================================== -->
    
	
	<!-- alternative javadoc code with hard coded directories -->
	<!-- ================================================= -->
	<!-- Added by kelsaka: Creates javadoc for the project -->
	<!-- ================================================= -->
	<target name="javadoc-pcm" description="Generate JavaDoc for the project">		
			<echo>starting to create JavaDoc PCM...</echo>		
			<mkdir dir="/home/ccontrol/pluginbuilder/de.uka.ipd.sdq.pluginbuilder/updateSite/javadoc/"/>
		    <javadoc 
		    	destdir="/home/ccontrol/pluginbuilder/de.uka.ipd.sdq.pluginbuilder/updateSite/javadoc/"
		    	author="true" 
		    	defaultexcludes="yes" 
		    	use="true" 
		    	version="true"     			    	
		    	public="true"
		    	verbose="true"			
		    	windowtitle="Palladio Component Model PCM"
		    	linkoffline="http://www.palladio-approach.net"	    	
		    	failonerror="false"
		    	maxmemory="256m"		    	
		    	>		    	
		<!--
		    	source="${buildDirectory}"  
		    	excludepackagenames="${build.src.excludes}"
		    	excludepackagenames="com.*" 
		    	packagenames="${build.doc.packages}"
		    	public="true"
		    	sourcepathref="project.source"
		-->
		        <!-- <classpath refid="de.uka.ipd.sdq.classpath"/> -->
		        <doctitle><![CDATA[<h1>${project.name}</h1]]></doctitle>
		        <link href="http://java.sun.com/javase/6/docs/api/"/>
			<!-- <taglet name="org.apache.commons.attributes.javadoc.CATaglet" 
				path="${ant.home}/lib/commons-attributes-compiler-2.2.jar"/> -->	

		    	<fileset dir="/home/ccontrol/pluginbuilder/de.uka.ipd.sdq.pluginbuilder/plugins/" defaultexcludes="yes" erroronmissingdir="false">
		    		<!-- <include name="de/uka/ipd/sdq/**/*.java"/> 
		    		<include name="de/uka/ipd/sdq/**/*.java"/>
		    		<exclude name="com/**" />
		    		<exclude name="org/**" />
		    		<exclude name="net/**" /> -->
		    		<!-- <include name="de.uka.ipd.sdq.**/*.java" /> --> 
		    		<!-- <exclude name="" /> -->

		    		<!-- <include name="**/*.java" /> -->
		    			
		    		<!-- <include name="de.uka.ipd.sdq.codegen.simucontroller/**/*.java" />		    		
		    		<include name="de.uka.ipd.sdq.sensorframework.adapter/**/*.java" />
		    		<include name="de.uka.ipd.sdq.pcm.gmf.allocation/**/*.java" />
		    		<include name="de.uka.ipd.sdq.stoex.analyser/**/*.java" />
		    		<include name="de.uka.ipd.sdq.branding/**/*.java" />
		    		<include name="de.uka.ipd.sdq.completions/**/*.java" />
		    		<include name="de.uka.ipd.sdq.pcm.gmf.composite/**/*.java" />
		    		<include name="de.uka.ipd.sdq.scheduler.configuration/**/*.java" />
		    		<include name="de.uka.ipd.sdq.context/**/*.java" />
		    		<include name="de.uka.ipd.sdq.codegen.simudatavisualisation.datatypes/**/*.java" />	
		    		<include name="de.uka.ipd.sdq.codegen.simucontroller/**/*.java" />
		    		<include name="de.uka.ipd.sdq.simucomframework.desmoj/**/*.java" />
		    		<include name="de.uka.ipd.sdq.dialogs/**/*.java" />
		    		<include name="de.uka.ipd.sdq.pcm.dialogs/**/*.java" />
		    		<include name="de.uka.ipd.sdq.sensorframework.dialogs/**/*.java" />
		    		<include name="de.uka.ipd.sdq.completions.edit/**/*.java" />
		    		<include name="de.uka.ipd.sdq.context.edit/**/*.java" /> -->
		    		<include name="de.uka.ipd.sdq.pcm/**/*.java" />
		    		
		    		
				</fileset>
		    	<!-- <fileset dir="/home/ccontrol/pluginbuilder/de.uka.ipd.sdq.pluginbuilder/plugins/" includes="**/*.java"/> -->
	    </javadoc>
		<echo>...finished JavaDoc PCM.</echo>	
	</target>
	<!-- ======================================== -->	
	
	
</project>
